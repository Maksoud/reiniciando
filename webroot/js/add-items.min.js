jQuery(document).ready(function(e){function t(e){var t=!1;e<0&&(t=!0),e=e.replace(/\D/g,"");var u=(e=new String(Number(e))).length;return 1==u?e=e.replace(/(\d)/,"0,0$1"):2==u?e=e.replace(/(\d)/,"0,$1"):u>2&&u<=5?e=e.replace(/(\d{2})$/,",$1"):u>5&&(e=e.replace(/(\d{2})$/,",$1").replace(/\d(?=(?:\d{3})+(?:\D|$))/g,"$&.")),t&&(e="-"+e),e}function u(e){var t=!1;e<0&&(t=!0),e=e.replace(/\D/g,"");var u=(e=new String(Number(e))).length;return 1==u?e=e.replace(/(\d)/,"0,000$1"):2==u?e=e.replace(/(\d)/,"0,00$1"):3==u?e=e.replace(/(\d)/,"0,0$1"):4==u?e=e.replace(/(\d{4})$/,"0,$1"):u>4&&(e=e.replace(/(\d{4})$/,",$1")),t&&(e="-"+e),e}function r(e){var t=!1;-1!==e.search("-")&&(t=!0,console.log("Atenção: Valor negativo!")),e=e.replace(/\D/g,"");var u=(e=new String(Number(e))).length;return 1==u?e=e.replace(/(\d)/,"0.0$1"):2==u?e=e.replace(/(\d)/,"0.$1"):u>2&&(e=e.replace(/(\d{2})$/,".$1")),t&&(e="-"+e),e}function l(e){var t=!1;-1!==e.search("-")&&(t=!0,console.log("Atenção: Valor negativo!")),e=e.replace(/\D/g,"");var u=(e=new String(Number(e))).length;return 1==u?e=e.replace(/(\d)/,"0.000$1"):2==u?e=e.replace(/(\d)/,"0.00$1"):3==u?e=e.replace(/(\d)/,"0.0$1"):4==u?e=e.replace(/(\d{4})$/,"0.$1"):u>4&&(e=e.replace(/(\d{4})$/,".$1")),t&&(e="-"+e),e}var a=0;function o(e,u,r){var l=document.querySelector("#totalproducts"),a=document.querySelector("#vltotalproducts"),o=document.querySelector("#totalipi"),d=document.querySelector("#vltotalipi"),n=document.querySelector("#totalicms"),c=document.querySelector("#vltotalicms"),v=document.querySelector("#totalicmssubst"),m=document.querySelector("#vltotalicmssubst"),s=document.querySelector("#totaldiscount"),b=document.querySelector("#vltotaldiscount"),p=document.querySelector("#grandtotal"),y=document.querySelector("#vlgrandtotal"),N=Number(a.value),S=Number(d.value),g=Number(c.value),x=Number(m.value),_=Number(b.value),q=Number(y.value),F=0;for(i=0;i<e.length;i++){var h=e[i].getElementsByTagName("input");for(ii=0;ii<h.length;ii++)switch(id=h[ii].id,va=h[ii].value,id){case"list_id_product":case"list_product":case"list_unity":break;case"list_quantity":F=Number(va)}}for(i=0;i<u.length;i++)for(h=u[i].getElementsByTagName("input"),ii=0;ii<h.length;ii++)switch(id=h[ii].id,va=h[ii].value,id){case"list_vlunity":a.value=r?Number(N-Number(F*va)).toFixed(2):Number(N+Number(F*va)).toFixed(2),l.innerHTML=t(String(Number(a.value).toFixed(2)));break;case"list_vldiscount":b.value=r?Number(_-Number(va)).toFixed(2):Number(_+Number(va)).toFixed(2),s.innerHTML=t(String(Number(b.value).toFixed(2)));break;case"list_icms":c.value=r?Number(g-Number(va)).toFixed(2):Number(g+Number(va)).toFixed(2),n.innerHTML=t(String(Number(c.value).toFixed(2)));break;case"list_ipi":d.value=r?Number(S-Number(va)).toFixed(2):Number(S+Number(va)).toFixed(2),o.innerHTML=t(String(Number(d.value).toFixed(2)));break;case"list_icmssubst":m.value=r?Number(x-Number(va)).toFixed(2):Number(x+Number(va)).toFixed(2),v.innerHTML=t(String(Number(m.value).toFixed(2)));break;case"list_vltotal":y.value=r?Number(q-Number(va)).toFixed(2):Number(q+Number(va)).toFixed(2),p.innerHTML=t(String(Number(y.value).toFixed(2)))}}AddTableRow=function(){var i=document.querySelector("#products_id"),d=document.querySelector("#products_title"),n=document.querySelector("#edt_imobilizado"),c=document.querySelector("#edt_unity"),v=document.querySelector("#edt_quantity"),m=document.querySelector("#edt_vlunity"),s=document.querySelector("#edt_vldiscount"),b=document.querySelector("#edt_ipi"),p=document.querySelector("#edt_peripi"),y=document.querySelector("#edt_icms"),N=document.querySelector("#edt_pericms"),S=document.querySelector("#edt_icmssubst"),g=document.querySelector("#edt_pericmssubst");if(""!=v.value?qtd=Number(l(v.value)).toFixed(4):qtd=0,""==i.value)return alert("Produto não identificado"),!1;if(""==d.value)return alert("Produto não informado"),!1;if(""==c.value)return alert("Unidade não informada"),!1;if(qtd<1e-4)return alert("Quantidade não informada"),!1;if(""==m.value)return alert("Valor unitário não informado"),!1;if(""==s.value)return alert("Valor desconto não informado"),!1;if(""==b.value&&""==p.value)return alert("IPI não informado"),!1;if(""==y.value&&""==N.value)return alert("ICMS não informado"),!1;if(""==S.value&&""==g.value)return alert("ICMS de substituição não informado"),!1;""==y.value||N.value,""==b.value||p.value,""==S.value||g.value,m.value=Number(l(m.value)).toFixed(4),s.value=Number(r(s.value)).toFixed(2),b.value=Number(r(b.value)).toFixed(2),p.value=Number(r(p.value)).toFixed(2),y.value=Number(r(y.value)).toFixed(2),N.value=Number(r(N.value)).toFixed(2),S.value=Number(r(S.value)).toFixed(2),g.value=Number(r(g.value)).toFixed(2);var x,_,q,F=Number(qtd)*Number(m.value)-Number(s.value)+Number(b.value)+Number(S.value),h=e('<tr style="font-size: 11px;">');x='<td colspan="4" class="text-nowrap">\n<input type="hidden" name="ProductList['+a+'][products_id]" id="list_id_product" value="'+i.value+'">\n<input type="hidden" name="ProductList['+a+'][products_title]" id="list_product" value="'+d.value+'">\n<input type="hidden" name="ProductList['+a+'][imobilizado]" id="list_imobilizado" value="'+n.checked+'">\n&nbsp;'+i.value+" - "+d.value+"</td>",_='<td class="text-center">\n<input type="hidden" name="ProductList['+a+'][unity]" id="list_unity" value="'+c.value+'">\n&nbsp;'+c.value+"</td>",q='<td class="text-center">\n<input type="hidden" name="ProductList['+a+'][quantity]" id="list_quantity" value="'+String(qtd)+'">\n&nbsp;'+u(String(qtd))+"</td>";var f=h.append(x+_+q+'<td rowspan="2" class="text-center bg-gray" style="padding:12px;">\n<button onclick="EditTableRow(this)" type="button" class="btn btn-actions fa fa-pencil" style="vertical-align: middle;" title="Editar"></button>\n<button onclick="RemoveTableRow(this)" type="button" class="btn btn-actions fa fa-trash" style="vertical-align: middle;" title="Excluir"></button>\n</td>');e("#products-table").append(h);var k,$,L,P,w,T,z=e('<tr style="font-size: 11px;">');k='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][vlunity]" id="list_vlunity" value="'+String(Number(m.value).toFixed(4))+'">\n&nbsp;'+u(String(Number(m.value).toFixed(4)))+"</td>",$='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][vldiscount]" id="list_vldiscount" value="'+String(s.value)+'">\n&nbsp;'+t(String(Number(s.value).toFixed(2)))+"</td>",L='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][ipi]" id="list_ipi" value="'+String(b.value)+'">\n<input type="hidden" name="ProductList['+a+'][peripi]" id="list_peripi" value="'+String(p.value)+'">\n&nbsp;'+t(String(Number(b.value).toFixed(2)))+" ("+t(String(Number(p.value).toFixed(2)))+")</td>",P='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][icms]" id="list_icms" value="'+String(y.value)+'">\n<input type="hidden" name="ProductList['+a+'][pericms]" id="list_pericms" value="'+String(N.value)+'">\n&nbsp;'+t(String(Number(y.value).toFixed(2)))+" ("+t(String(Number(N.value).toFixed(2)))+")</td>",w='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][icmssubst]" id="list_icmssubst" value="'+String(S.value)+'">\n<input type="hidden" name="ProductList['+a+'][pericmssubst]" id="list_pericmssubst" value="'+String(g.value)+'">\n&nbsp;'+t(String(Number(S.value).toFixed(2)))+" ("+t(String(Number(g.value).toFixed(2)))+")</td>",T='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][vltotal]" id="list_vltotal" value="'+String(Number(F).toFixed(2))+'">\n&nbsp;'+t(String(Number(F).toFixed(2)))+"</td>";var R=z.append(k+$+P+L+w+T);e("#products-table").append(z),o(f[0].cells,R[0].cells,!1),a+=1,i.value="",d.value="",n.checked=!1,c.value="UN",v.value="",m.value="",s.value="",b.value="",p.value="",y.value="",N.value="",S.value="",g.value=""},EditTableRow=function(a){var o=document.querySelector("#products_id"),d=document.querySelector("#products_title"),n=document.querySelector("#edt_imobilizado"),c=document.querySelector("#edt_unity"),v=document.querySelector("#edt_quantity"),m=document.querySelector("#edt_vlunity"),s=document.querySelector("#edt_vldiscount"),b=document.querySelector("#edt_ipi"),p=document.querySelector("#edt_peripi"),y=document.querySelector("#edt_icms"),N=document.querySelector("#edt_pericms"),S=document.querySelector("#edt_icmssubst"),g=document.querySelector("#edt_pericmssubst");v.value=Number(l(v.value)).toFixed(4),m.value=Number(l(m.value)).toFixed(4),s.value=Number(r(s.value)).toFixed(2),b.value=Number(r(b.value)).toFixed(2),p.value=Number(r(p.value)).toFixed(2),y.value=Number(r(y.value)).toFixed(2),N.value=Number(r(N.value)).toFixed(2),S.value=Number(r(S.value)).toFixed(2),g.value=Number(r(g.value)).toFixed(2);var x=e(a).closest("tr"),_=x[0].cells,q=x.next("tr")[0].cells;for(i=0;i<_.length;i++){var F=_[i].getElementsByTagName("input");for(ii=0;ii<F.length;ii++)switch(id=F[ii].id,va=F[ii].value,id){case"list_id_product":o.value=va;break;case"list_product":d.value=String(va);break;case"list_imobilizado":n.checked=va;break;case"list_unity":c.value=String(va);break;case"list_quantity":v.value=u(String(va))}}for(i=0;i<q.length;i++)for(F=q[i].getElementsByTagName("input"),ii=0;ii<F.length;ii++)switch(id=F[ii].id,va=F[ii].value,id){case"list_vlunity":m.value=u(String(va));break;case"list_vldiscount":s.value=t(String(va));break;case"list_ipi":b.value=t(String(va));break;case"list_peripi":p.value=t(String(100*va));break;case"list_icms":y.value=t(String(va));break;case"list_pericms":N.value=t(String(100*va));break;case"list_icmssubst":S.value=t(String(va));break;case"list_pericmssubst":g.value=t(String(100*va))}RemoveTableRow(a)},RemoveTableRow=function(t){var u=e(t).closest("tr");return o(u[0].cells,u.next("tr")[0].cells,!0),u.fadeOut(350,function(){e(this).closest("tr").next().remove(),e(this).closest("tr").remove()}),!1};var d=e("input[name='ipi']"),n=e("input[name='peripi']");d.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_peripi"),o=0,d=0,n=0,c=0,v=0;try{e.value&&(o=Number(l(e.value)).toFixed(4)),u.value&&(d=Number(l(u.value)).toFixed(4)),i.value&&(n=Number(r(i.value)).toFixed(2)),a.value&&(c=Number(r(a.value)).toFixed(2)),totalproducts=o*d,n>0&&!c&&(v=t(String(Number(100*n/Number(totalproducts)).toFixed(2))),a.value=v)}catch(e){console.log(e.message)}}),n.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_peripi"),o=0,d=0,n=0,c=0,v=0;try{e.value&&(o=Number(l(e.value)).toFixed(4)),u.value&&(d=Number(l(u.value)).toFixed(4)),i.value&&(n=Number(r(i.value)).toFixed(2)),a.value&&(c=Number(r(a.value)).toFixed(2)),totalproducts=o*d,c>0&&!n&&(v=t(String(Number(Number(totalproducts)*(c/100)).toFixed(2))),i.value=v)}catch(e){console.log(e.message)}});var c=e("input[name='icms']"),v=e("input[name='pericms']");c.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_icms"),o=document.querySelector("#edt_pericms"),d=document.querySelector("#edt_imobilizado"),n=0,c=0,v=0,m=0,s=0,b=0;try{e.value&&(n=Number(l(e.value)).toFixed(4)),u.value&&(c=Number(l(u.value)).toFixed(4)),i.value&&(v=Number(r(i.value)).toFixed(2)),a.value&&(m=Number(r(a.value)).toFixed(2)),o.value&&(s=Number(r(o.value)).toFixed(2)),totalproducts=n*c,s&&0!=s||(m>0&&!d.checked?(b=t(String(Number(100*m/Number(totalproducts)).toFixed(2))),o.value=b):m>0&&d.checked&&(b=t(String(Number(100*m/(Number(totalproducts)+Number(v))).toFixed(2))),o.value=b))}catch(e){console.log(e.message)}}),v.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_icms"),o=document.querySelector("#edt_pericms"),d=document.querySelector("#edt_imobilizado"),n=0,c=0,v=0,m=0,s=0,b=0;try{e.value&&(n=Number(l(e.value)).toFixed(4)),u.value&&(c=Number(l(u.value)).toFixed(4)),i.value&&(v=Number(r(i.value)).toFixed(2)),a.value&&(m=Number(r(a.value)).toFixed(2)),o.value&&(s=Number(r(o.value)).toFixed(2)),totalproducts=n*c,m&&0!=m||(s>0&&!d.checked?(b=t(String(Number(Number(totalproducts)*(s/100)).toFixed(2))),a.value=b):s>0&&d.checked&&(b=t(String(Number((Number(totalproducts)+Number(v))*(s/100)).toFixed(2))),a.value=b))}catch(e){console.log(e.message)}});var m=e("input[name='icmssubst']"),s=e("input[name='pericmssubst']");m.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_icmssubst"),o=document.querySelector("#edt_pericmssubst"),d=document.querySelector("#edt_imobilizado"),n=0,c=0,v=0,m=0,s=0,b=0;try{e.value&&(n=Number(l(e.value)).toFixed(4)),u.value&&(c=Number(l(u.value)).toFixed(4)),i.value&&(v=Number(r(i.value)).toFixed(2)),a.value&&(m=Number(r(a.value)).toFixed(2)),o.value&&(s=Number(r(o.value)).toFixed(2)),totalproducts=n*c,s&&0!=s||(m>0&&!d.checked?(b=t(String(Number(100*m/Number(totalproducts)).toFixed(2))),o.value=b):m>0&&d.checked&&(b=t(String(Number(100*m/(Number(totalproducts)+Number(v))).toFixed(2))),o.value=b))}catch(e){console.log(e.message)}}),s.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_icmssubst"),o=document.querySelector("#edt_pericmssubst"),d=document.querySelector("#edt_imobilizado"),n=0,c=0,v=0,m=0,s=0,b=0;try{e.value&&(n=Number(l(e.value)).toFixed(4)),u.value&&(c=Number(l(u.value)).toFixed(4)),i.value&&(v=Number(r(i.value)).toFixed(2)),a.value&&(m=Number(r(a.value)).toFixed(2)),o.value&&(s=Number(r(o.value)).toFixed(2)),totalproducts=n*c,m&&0!=m||(s>0&&!d.checked?(b=t(String(Number(Number(totalproducts)*(s/100)).toFixed(2))),a.value=b):s>0&&d.checked&&(b=t(String(Number((Number(totalproducts)+Number(v))*(s/100)).toFixed(2))),a.value=b))}catch(e){console.log(e.message)}})});