jQuery(document).ready(function(t){function e(t){var e=!1;t<0&&(e=!0),t=t.replace(/\D/g,"");var i=(t=new String(Number(t))).length;return 1==i?t=t.replace(/(\d)/,"0,0$1"):2==i?t=t.replace(/(\d)/,"0,$1"):i>2&&i<=5?t=t.replace(/(\d{2})$/,",$1"):i>5&&(t=t.replace(/(\d{2})$/,",$1").replace(/\d(?=(?:\d{3})+(?:\D|$))/g,"$&.")),e&&(t="-"+t),t}function n(t){var e=!1;t<0&&(e=!0),t=t.replace(/\D/g,"");var i=(t=new String(Number(t))).length;return 1==i?t=t.replace(/(\d)/,"0,000$1"):2==i?t=t.replace(/(\d)/,"0,00$1"):3==i?t=t.replace(/(\d)/,"0,0$1"):i>=4&&(t=t.replace(/(\d{4})$/,",$1")),e&&(t="-"+t),t}function r(i){t.ajax({url:i,type:"get",dataType:"JSON",data:new FormData(this),processData:!1,contentType:!1,success:function(i,r){if("error"==i.status)for(var l in i.errors)for(var a in t("[name="+l+"]").focus().parent().addClass("has-error"),i.errors[l])t("[name="+l+"]").parent().append('<span class="help-block"><small>'+i.errors[l][a]+"</small></span> ");else{t("#products-table tr>td").remove();for(var o=0;o<i.length;o++){var d,s,c,m=i[o].products_id,p=i[o].code,v=i[o].title,b=i[o].unity,g=i[o].quantity,y=i[o].imobilizado,S=i[o].icms,h=i[o].pericms,x=i[o].icmssubst,N=i[o].pericmssubst,_=i[o].ipi,q=i[o].peripi,f=i[o].vlunity,F=i[o].vldiscount,L=i[o].vltotal,w=t('<tr style="font-size: 11px;">');d='<td colspan="4" class="text-nowrap">\n<input type="hidden" name="ProductList['+m+'][products_id]" id="list_id_product" value="'+m+'">\n<input type="hidden" name="ProductList['+m+'][products_title]" id="list_product" value="'+v+'">\n<input type="hidden" name="ProductList['+m+'][imobilizado]" id="list_imobilizado" value="'+y+'">\n&nbsp;'+p+" - "+v+"</td>",s='<td class="text-center">\n<input type="hidden" name="ProductList['+m+'][unity]" id="list_unity" value="'+b+'">\n&nbsp;'+b+"</td>",c='<td class="text-center">\n<input type="hidden" name="ProductList['+m+'][quantity]" id="list_quantity" value="'+String(Number(g).toFixed(4))+'">\n&nbsp;'+n(String(Number(g).toFixed(4)))+"</td>";var T=w.append(d+s+c+'<td rowspan="2" class="text-center bg-gray" style="padding:12px;">\n<button onclick="EditTableRow(this)" type="button" class="btn btn-actions fa fa-pencil" style="vertical-align: middle;" title="Editar"></button>\n<button onclick="RemoveTableRow(this)" type="button" class="btn btn-actions fa fa-trash" style="vertical-align: middle;" title="Excluir"></button>\n  </td>');t("#products-table").append(w);var P,$,H,M,k,E,z=t('<tr style="font-size: 11px;">');P='<td class="text-right">\n<input type="hidden" name="ProductList['+m+'][vlunity]" id="list_vlunity" value="'+String(Number(f).toFixed(4))+'">\n&nbsp;'+n(String(Number(f).toFixed(4)))+"</td>",$='<td class="text-right">\n<input type="hidden" name="ProductList['+m+'][vldiscount]" id="list_vldiscount" value="'+String(F)+'">\n&nbsp;'+e(String(Number(F).toFixed(2)))+"</td>",H='<td class="text-right">\n<input type="hidden" name="ProductList['+m+'][ipi]" id="list_ipi" value="'+String(_)+'">\n<input type="hidden" name="ProductList['+m+'][peripi]" id="list_peripi" value="'+String(q)+'">\n&nbsp;'+e(String(Number(_).toFixed(2)))+" ("+e(String(Number(q).toFixed(2)))+")</td>",M='<td class="text-right">\n<input type="hidden" name="ProductList['+m+'][icms]" id="list_icms" value="'+String(S)+'">\n<input type="hidden" name="ProductList['+m+'][pericms]" id="list_pericms" value="'+String(h)+'">\n&nbsp;'+e(String(Number(S).toFixed(2)))+" ("+e(String(Number(h).toFixed(2)))+")</td>",k='<td class="width-150 text-right">\n<input type="hidden" name="ProductList['+m+'][icmssubst]" id="list_icmssubst" value="'+String(x)+'">\n<input type="hidden" name="ProductList['+m+'][pericmssubst]" id="list_pericmssubst" value="'+String(N)+'">\n&nbsp;'+e(String(Number(x).toFixed(2)))+" ("+e(String(Number(N).toFixed(2)))+")</td>",E='<td class="text-right">\n<input type="hidden" name="ProductList['+m+'][vltotal]" id="list_vltotal" value="'+String(Number(L).toFixed(2))+'">\n&nbsp;'+e(String(Number(L).toFixed(2)))+"</td>";var D=z.append(P+$+M+H+k+E);t("#products-table").append(z),u(T[0].cells,D[0].cells)}}},error:function(t,e,i){console.log("/*******************/"),console.log(t),console.log(e),console.log(i),console.log("/*******************/")}})}function l(){var t=document.querySelector("#totalproducts"),e=document.querySelector("#vltotalproducts"),i=document.querySelector("#totalipi"),n=document.querySelector("#vltotalipi"),r=document.querySelector("#totalicms"),l=document.querySelector("#vltotalicms"),u=document.querySelector("#totalicmssubst"),a=document.querySelector("#vltotalicmssubst"),o=document.querySelector("#totaldiscount"),d=document.querySelector("#vltotaldiscount"),s=document.querySelector("#grandtotal"),c=document.querySelector("#vlgrandtotal");d.value=0,e.value=0,n.value=0,l.value=0,a.value=0,d.value=0,c.value=0,t.innerHTML="0,00",i.innerHTML="0,00",r.innerHTML="0,00",u.innerHTML="0,00",o.innerHTML="0,00",s.innerHTML="0,00"}function u(t,n){var r=document.querySelector("#totalproducts"),l=document.querySelector("#vltotalproducts"),u=document.querySelector("#totalipi"),a=document.querySelector("#vltotalipi"),o=document.querySelector("#totalicms"),d=document.querySelector("#vltotalicms"),s=document.querySelector("#totalicmssubst"),c=document.querySelector("#vltotalicmssubst"),m=document.querySelector("#totaldiscount"),p=document.querySelector("#vltotaldiscount"),v=document.querySelector("#grandtotal"),b=document.querySelector("#vlgrandtotal"),g=Number(l.value),y=Number(a.value),S=Number(d.value),h=Number(c.value),x=Number(p.value),N=Number(b.value),_=0;for(i=0;i<t.length;i++){var q=t[i].getElementsByTagName("input");for(ii=0;ii<q.length;ii++)switch(id=q[ii].id,va=q[ii].value,id){case"list_id_product":case"list_product":case"list_unity":break;case"list_quantity":_=Number(va)}}for(i=0;i<n.length;i++)for(q=n[i].getElementsByTagName("input"),ii=0;ii<q.length;ii++)switch(id=q[ii].id,va=q[ii].value,id){case"list_vlunity":l.value=Number(g+Number(_*va)).toFixed(2),r.innerHTML=e(String(Number(l.value).toFixed(2)));break;case"list_vldiscount":p.value=Number(x+Number(va)).toFixed(2),m.innerHTML=e(String(Number(p.value).toFixed(2)));break;case"list_icms":d.value=Number(S+Number(va)).toFixed(2),o.innerHTML=e(String(Number(d.value).toFixed(2)));break;case"list_ipi":a.value=Number(y+Number(va)).toFixed(2),u.innerHTML=e(String(Number(a.value).toFixed(2)));break;case"list_icmssubst":c.value=Number(h+Number(va)).toFixed(2),s.innerHTML=e(String(Number(c.value).toFixed(2)));break;case"list_vltotal":b.value=Number(N+Number(va)).toFixed(2),v.innerHTML=e(String(Number(b.value).toFixed(2)))}}t("#purchases_id").on("change",function(){var e=t("#logo").attr("data-url")+"purchases/json_items/?query="+t("#purchases_id option:selected").val();l(),r(e)}),t("#sells_id").on("change",function(){var e=t("#logo").attr("data-url")+"sells/json_items/?query="+t("#sells_id option:selected").val();l(),r(e)}),t('input[name="type"]').on("change",function(){l(),t("#products-table tr>td").remove(),document.getElementById("purchases_id").selectedIndex=0,document.getElementById("sells_id").selectedIndex=0})});